"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5162],{80006:function(j,h,t){t.d(h,{G:function(){return R}});var e=t(32735),p=t(96192),d=t(59177),f=t(20108);function R(){const{get:L}=(0,p.kY)(),{formatAPIError:I}=(0,p.So)(),l=(0,p.lm)(),F=(0,f.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:m}}=await L("/content-manager/components");return m},onError(m){m instanceof d.d7&&l({type:"warning",message:I(m)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:m}}=await L("/content-manager/content-types");return m},onError(m){m instanceof d.d7&&l({type:"warning",message:I(m)})}}]),[Z,D]=F,w=Z.isLoading||D.isLoading,A=e.useMemo(()=>(D?.data??[]).filter(m=>m.kind==="collectionType"&&m.isDisplayed),[D?.data]),H=e.useMemo(()=>(D?.data??[]).filter(m=>m.kind!=="collectionType"&&m.isDisplayed),[D?.data]);return{isLoading:w,components:e.useMemo(()=>Z?.data??[],[Z?.data]),collectionTypes:A,singleTypes:H}}},36795:function(j,h,t){var e=t(32735),p=t(45175),d=t(84642),f=t(99391),R=t(35547),L=t(73530),I=t(52070),l=t(52945),F=t(99320),Z=t(8365),D=t(8541),w=t(31014),A=t(96669),H=t(92802),m=t(60216),v=t.n(m),X=t(67879),k=t(8471),de=t(80006);const g=s=>s.reduce((o,c)=>{const b=c.split(".")[0];return o[b]||(o[b]=[]),o[b].push(c),o},{}),$=(0,k.ZP)(p.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,le=s=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},ee=s=>{const o=["entry.create","entry.update","entry.delete"];return s&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},te=e.createContext(),ie=({children:s})=>{const{formatMessage:o}=(0,X.Z)(),{collectionTypes:c,isLoading:b}=(0,de.G)(),O=e.useMemo(()=>c.some(x=>x.options.draftAndPublish===!0),[c]),P=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(te.Provider,{value:{isDraftAndPublish:O}},e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(f.Q,{"aria-hidden":!0},P),b&&e.createElement(R.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement($,{"aria-label":P},s)))};ie.propTypes={children:v().oneOfType([v().arrayOf(v().node),v().node]).isRequired};const ne=({getHeaders:s=le})=>{const{isDraftAndPublish:o}=e.useContext(te),{formatMessage:c}=(0,X.Z)(),b=s(o);return e.createElement(L.S,null,e.createElement(I.Z,null,e.createElement(l.g,null,e.createElement(F.T,null,c({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),b.map(O=>["app.utils.publish","app.utils.unpublish"].includes(O.id)?e.createElement(l.g,{key:O.id,title:c({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(Z.Z,{variant:"sigma",textColor:"neutral600"},c(O))):e.createElement(l.g,{key:O.id},e.createElement(Z.Z,{variant:"sigma",textColor:"neutral600"},c(O))))))};ne.defaultProps={getHeaders:le},ne.propTypes={getHeaders:v().func};const ae=({providedEvents:s})=>{const{isDraftAndPublish:o}=e.useContext(te),c=s||ee(o),{values:b,handleChange:O}=(0,H.u6)(),P="events",x=b.events,N=[],se=g(x),W=({target:{name:M,value:E}})=>{let T=new Set(x);E?T.add(M):T.delete(M),O({target:{name:P,value:Array.from(T)}})},z=({target:{name:M,value:E}})=>{let T=new Set(x);E?c[M].forEach(J=>{N.includes(J)||T.add(J)}):c[M].forEach(J=>T.delete(J)),O({target:{name:P,value:Array.from(T)}})};return e.createElement(D.X,null,Object.entries(c).map(([M,E])=>e.createElement(Y,{disabledEvents:N,key:M,name:M,events:E,inputValue:se[M],handleSelect:W,handleSelectAll:z})))};ae.defaultProps={providedEvents:null},ae.propTypes={providedEvents:v().object};const ce=s=>s.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),Y=({disabledEvents:s,name:o,events:c,inputValue:b,handleSelect:O,handleSelectAll:P})=>{const{formatMessage:x}=(0,X.Z)(),N=c.filter(E=>!s.includes(E)),se=b.length>0,W=b.length===N.length,z=({target:{name:E}})=>{P({target:{name:E,value:!W}})},M=5;return e.createElement(I.Z,null,e.createElement(l.f,null,e.createElement(w.X,{indeterminate:se&&!W,"aria-label":x({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:z,value:W},ce(o))),c.map(E=>e.createElement(l.f,{key:E},e.createElement(A.C,{disabled:s.includes(E),"aria-label":E,name:E,value:b.includes(E),onValueChange:T=>O({target:{name:E,value:T}})}))),c.length<M&&e.createElement(l.f,{colSpan:M-c.length}))};Y.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},Y.propTypes={disabledEvents:v().array,events:v().array,inputValue:v().array,handleSelect:v().func,handleSelectAll:v().func,name:v().string.isRequired},h.Z={Root:ie,Headers:ne,Body:ae,EventRow:Y}},77476:function(j,h,t){t.d(h,{Z:function(){return fe}});var e=t(32735),p=t(95162),d=t(96192),f=t(20108),R=t(53038),L=t(80006),I=t(64092),l=t(84642),F=t(91779),Z=t(56932),D=t(77981),w=t(10710),A=t(97037),H=t(2846),m=t(58518),v=t(40501),X=t(70788),k=t(92802),de=t(60216),g=t.n(de),$=t(67879),le=t(40957),ee=t(36795);function te(){return e.createElement(ee.Z.Root,null,e.createElement(ee.Z.Headers,null),e.createElement(ee.Z.Body,null))}var ie=t(99391),ne=t(43743),ae=t(82064),ce=t(70843),Y=t(8241);const s=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],o=({name:n,onChange:a,value:r,...u})=>{const{values:{headers:y}}=(0,k.u6)(),[S,i]=(0,e.useState)(s);(0,e.useEffect)(()=>{i(s.filter(C=>!y?.some(V=>V.key!==r&&V.key===C)))},[y,r]);const G=C=>{a({target:{name:n,value:C}})},q=C=>{i(V=>[...V,C]),G(C)};return e.createElement(ce.XU,{...u,onClear:()=>G(""),onChange:G,onCreateOption:q,placeholder:"",value:r},S.map(C=>e.createElement(Y.O,{value:C,key:C},C)))};o.defaultProps={value:void 0},o.propTypes={name:g().string.isRequired,onChange:g().func.isRequired,value:g().string};var c=o,O=()=>{const{formatMessage:n}=(0,$.Z)(),{values:a,errors:r}=(0,k.u6)();return e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(ie.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(D.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(k.F2,{validateOnChange:!1,name:"headers",render:({push:u,remove:y})=>e.createElement(w.r,{gap:4},a.headers.map((S,i)=>e.createElement(e.Fragment,{key:`${i}.${S.key}`},e.createElement(A.P,{col:6},e.createElement(k.gN,{as:c,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:r.headers?.[i]?.key&&r.headers[i].key})),e.createElement(A.P,{col:6},e.createElement(l.k,{alignItems:"flex-end"},e.createElement(D.x,{style:{flex:1}},e.createElement(k.gN,{as:H.o,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:r.headers?.[i]?.value&&r.headers[i].value})),e.createElement(l.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:r.headers?.[i]?.value?0:5},e.createElement(d.fG,{disabled:a.headers.length===1,onClick:()=>y(i),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})))))),e.createElement(A.P,{col:12},e.createElement(ne.A,{type:"button",onClick:()=>{u({key:"",value:""})},startIcon:e.createElement(ae.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))},P=t(8365),x=t(75760),N=t(98610),se=t(8471);const W=se.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),z=({isPending:n,statusCode:a})=>{const{formatMessage:r}=(0,$.Z)();return n?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(W,{as:x.Z}),e.createElement(P.Z,null,r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(W,{as:v.Z,color:"success700"}),e.createElement(P.Z,null,r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(W,{as:N.Z,color:"danger700"}),e.createElement(P.Z,null,r({id:"Settings.error",defaultMessage:"error"})," ",a)):null};z.propTypes={isPending:g().bool.isRequired,statusCode:g().number},z.defaultProps={statusCode:void 0};const M=({statusCode:n,message:a})=>{const{formatMessage:r}=(0,$.Z)();return n>=200&&n<300?e.createElement(l.k,{justifyContent:"flex-end"},e.createElement(P.Z,{textColor:"neutral600",ellipsis:!0},r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(l.k,{justifyContent:"flex-end"},e.createElement(l.k,{maxWidth:(0,d.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(P.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};M.propTypes={statusCode:g().number,message:g().string},M.defaultProps={statusCode:void 0,message:void 0};const E=({onCancel:n})=>{const{formatMessage:a}=(0,$.Z)();return e.createElement(l.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(l.k,{gap:2,alignItems:"center"},e.createElement(P.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(W,{as:N.Z,color:"neutral400"}))))};E.propTypes={onCancel:g().func.isRequired};const T=({isPending:n,onCancel:a,response:r})=>{const{statusCode:u,message:y}=r,{formatMessage:S}=(0,$.Z)();return e.createElement(D.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(w.r,{gap:4,style:{alignItems:"center"}},e.createElement(A.P,{col:3},e.createElement(P.Z,null,S({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(A.P,{col:3},e.createElement(z,{isPending:n,statusCode:u})),e.createElement(A.P,{col:6},n?e.createElement(E,{onCancel:a}):e.createElement(M,{statusCode:u,message:y}))))};T.defaultProps={isPending:!1,onCancel(){},response:{}},T.propTypes={isPending:g().bool,onCancel:g().func,response:g().object};var J=T,K=t(24346);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:n})=>K.Ry().shape({name:K.Z_().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:K.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:K.Vo(a=>{let r=K.IX();if(a.length===1){const{key:u,value:y}=a[0];if(!u&&!y)return r}return r.of(K.Ry().shape({key:K.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:K.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:K.IX()}),ue=({handleSubmit:n,triggerWebhook:a,isCreating:r,isTriggering:u,triggerResponse:y,data:S})=>{const{formatMessage:i}=(0,$.Z)(),[G,q]=(0,e.useState)(!1),C=(0,le.c)(te,async()=>(await t.e(7030).then(t.bind(t,61442))).EventTableEE),V=_=>Object.keys(_).length?Object.entries(_).map(([oe,re])=>({key:oe,value:re})):[{key:"",value:""}],U=(0,k.TA)({initialValues:{name:S?.name||"",url:S?.url||"",headers:V(S?.headers||{}),events:S?.events||[]},onSubmit(_,{resetForm:oe,setSubmitting:re}){n(_),oe({values:_}),re(!1)},validationSchema:he({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return C?e.createElement(k.Hy,{value:U},e.createElement(d.l0,{onSubmit:U.handleSubmit},e.createElement(I.T,{primaryAction:e.createElement(l.k,{gap:2},e.createElement(F.z,{onClick:()=>{a(),q(!0)},variant:"tertiary",startIcon:e.createElement(m.Z,null),disabled:r||u,size:"L"},i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(F.z,{startIcon:e.createElement(v.Z,null),type:"submit",size:"L",disabled:!U.dirty,loading:U.isSubmitting},i({id:"global.save",defaultMessage:"Save"}))),title:r?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):S?.name,navigationAction:e.createElement(d.rU,{startIcon:e.createElement(X.Z,null),to:"/settings/webhooks"},i({id:"global.back",defaultMessage:"Back"}))}),e.createElement(Z.D,null,e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},G&&e.createElement(J,{isPending:u,response:y,onCancel:()=>q(!1)}),e.createElement(D.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(w.r,{gap:6},e.createElement(A.P,{col:6},e.createElement(k.gN,{as:H.o,name:"name",error:U?.errors?.name&&U.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(A.P,{col:12},e.createElement(k.gN,{as:H.o,name:"url",error:U?.errors?.url&&U.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(O,null),e.createElement(C,null))))))):null};ue.propTypes={data:g().object,handleSubmit:g().func.isRequired,triggerWebhook:g().func.isRequired,isCreating:g().bool.isRequired,isTriggering:g().bool.isRequired,triggerResponse:g().object},ue.defaultProps={data:void 0,triggerResponse:void 0};var pe=ue;const me=n=>({...n,headers:n.headers.reduce((a,{key:r,value:u})=>(r!==""&&(a[r]=u),a),{})});var fe=()=>{const{params:{id:n}}=(0,R.$B)("/settings/webhooks/:id"),a=n==="create",{replace:r}=(0,R.k6)(),u=(0,d.lm)(),{formatAPIError:y}=(0,d.So)(),S=(0,f.useQueryClient)(),{isLoading:i}=(0,L.G)(),{put:G,get:q,post:C}=(0,d.kY)(),{isLoading:V,data:U,error:_}=(0,f.useQuery)(["webhooks",n],async()=>{const{data:{data:B}}=await q(`/admin/webhooks/${n}`);return B},{enabled:!a});e.useEffect(()=>{_&&u({type:"warning",message:y(_)})},[_,u,y]);const{isLoading:oe,data:re,isIdle:ve,mutate:Me}=(0,f.useMutation)(()=>C(`/admin/webhooks/${n}/trigger`)),ye=()=>Me(null,{onError(B){u({type:"warning",message:y(B)})}}),Ce=(0,f.useMutation)(B=>C("/admin/webhooks",B)),Pe=(0,f.useMutation)(({id:B,body:Q})=>G(`/admin/webhooks/${B}`,Q)),be=async B=>{if(a){Ce.mutate(me(B),{onSuccess({data:Q}){u({type:"success",message:{id:"Settings.webhooks.created"}}),r(`/settings/webhooks/${Q.data.id}`)},onError(Q){u({type:"warning",message:y(Q)})}});return}Pe.mutate({id:n,body:me(B)},{onSuccess(){S.invalidateQueries(["webhooks",n]),u({type:"success",message:{id:"notification.form.success.fields"}})},onError(Q){u({type:"warning",message:y(Q)})}})};return V||i?e.createElement(d.dO,null):e.createElement(p.o,null,e.createElement(d.SL,{name:"Webhooks"}),e.createElement(pe,{data:U,handleSubmit:be,triggerWebhook:ye,isCreating:a,isTriggering:oe,isTriggerIdle:ve,triggerResponse:re?.data.data}))}},5722:function(j,h,t){t.r(h);var e=t(32735),p=t(96192),d=t(40986),f=t(30305),R=t(77476);const L=()=>{const I=(0,d.v9)(f._);return e.createElement(p.O4,{permissions:I.settings.webhooks.create},e.createElement(R.Z,null))};h.default=L},63939:function(j,h,t){t.r(h);var e=t(32735),p=t(96192),d=t(40986),f=t(30305),R=t(77476);const L=()=>{const I=(0,d.v9)(f._);return e.createElement(p.O4,{permissions:I.settings.webhooks.update},e.createElement(R.Z,null))};h.default=L},8241:function(j,h,t){t.d(h,{O:function(){return p}});var e=t(70843);const p=e.Wx},70788:function(j,h,t){t.d(h,{Z:function(){return d}});var e=t(74512);const p=f=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...f,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),d=p},59177:function(j,h,t){t.d(h,{d7:function(){return d}});var e=t(84306);const{Axios:p,AxiosError:d,CanceledError:f,isCancel:R,CancelToken:L,VERSION:I,all:l,Cancel:F,isAxiosError:Z,spread:D,toFormData:w,AxiosHeaders:A,HttpStatusCode:H,formToJSON:m,getAdapter:v,mergeConfig:X}=e.default}}]);
