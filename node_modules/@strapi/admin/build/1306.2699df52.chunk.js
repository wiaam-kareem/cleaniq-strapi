(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[1306],{91595:function(T,m,e){"use strict";e.d(m,{Z:function(){return C}});var t=e(32735),c=e(64092),o=e(84642),a=e(91779),s=e(96192),r=e(40501),d=e(70788),y=e(60216),n=e.n(y),h=e(67879),v=e(69321),x=e(59177);const g=(U,B,D,I)=>{const[R,S]=(0,t.useState)(!1),k=(0,s.lm)(),{post:l}=(0,s.kY)(),{formatAPIError:$}=(0,s.So)();return{regenerateData:async()=>{try{const{data:{data:{accessKey:N}}}=await l(`${U}${B}/regenerate`);S(!1),D(N)}catch(N){S(!1),I?I(N):N instanceof x.d7&&k({type:"warning",message:$(N)})}},isLoadingConfirmation:R}},i=({onRegenerate:U,idToRegenerate:B,backUrl:D,onError:I})=>{const{formatMessage:R}=(0,h.Z)(),[S,k]=(0,t.useState)(!1),{regenerateData:l,isLoadingConfirmation:$}=g(D,B,U,I),Y=async()=>{l(),k(!1)};return t.createElement(t.Fragment,null,t.createElement(a.z,{startIcon:t.createElement(v.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>k(!0),name:"regenerate"},R({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(s.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(v.Z,null),isConfirmButtonLoading:$,isOpen:S,onToggleDialog:()=>k(!1),onConfirm:Y,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};i.defaultProps={onRegenerate(){},onError:void 0},i.propTypes={onRegenerate:n().func,idToRegenerate:n().oneOfType([n().number,n().string]).isRequired,backUrl:n().string.isRequired,onError:n().func};var p=i;const A=({title:U,token:B,setToken:D,canEditInputs:I,canRegenerate:R,isSubmitting:S,backUrl:k,regenerateUrl:l,onErrorRegenerate:$})=>{const{formatMessage:Y}=(0,h.Z)(),N=J=>{D({...B,accessKey:J})};return t.createElement(c.T,{title:B?.name||Y(U),primaryAction:I?t.createElement(o.k,{gap:2},R&&B?.id&&t.createElement(p,{backUrl:l,onRegenerate:N,idToRegenerate:B?.id,onError:$}),t.createElement(a.z,{disabled:S,loading:S,startIcon:t.createElement(r.Z,null),type:"submit",size:"S"},Y({id:"global.save",defaultMessage:"Save"}))):R&&B?.id&&t.createElement(p,{onRegenerate:N,idToRegenerate:B?.id,backUrl:l}),navigationAction:t.createElement(s.rU,{startIcon:t.createElement(d.Z,null),to:k},Y({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};A.propTypes={token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().oneOfType([n().number,n().string]),name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),canEditInputs:n().bool.isRequired,canRegenerate:n().bool.isRequired,setToken:n().func.isRequired,isSubmitting:n().bool.isRequired,backUrl:n().string.isRequired,title:n().shape({id:n().string,label:n().string}).isRequired,regenerateUrl:n().string.isRequired,onErrorRegenerate:n().func},A.defaultProps={token:void 0,onErrorRegenerate:void 0};var C=A},82505:function(T,m,e){"use strict";var t=e(32735),c=e(16773),o=e(40260),a=e(8365),s=e(60216),r=e.n(s),d=e(67879),y=e(25652);const n=({token:h,errors:v,values:x,onChange:g,isCreating:i})=>{const{formatMessage:p}=(0,d.Z)();return t.createElement(t.Fragment,null,t.createElement(c.P,{name:"lifespan",label:p({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:x.lifespan!==null?x.lifespan:"0",error:v.lifespan?p(v.lifespan?.id?v.lifespan:{id:v.lifespan,defaultMessage:v.lifespan}):null,onChange:A=>{g({target:{name:"lifespan",value:A}})},required:!0,disabled:!i,placeholder:"Select"},t.createElement(o.W,{value:"604800000"},p({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(o.W,{value:"2592000000"},p({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(o.W,{value:"7776000000"},p({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(o.W,{value:"0"},p({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(a.Z,{variant:"pi",textColor:"neutral600"},!i&&`${p({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,y.IX)(h?.createdAt,parseInt(x.lifespan,10))}`))};n.propTypes={errors:r().shape({lifespan:r().string}),onChange:r().func.isRequired,values:r().shape({lifespan:r().oneOfType([r().number,r().string])}).isRequired,isCreating:r().bool.isRequired,token:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},n.defaultProps={errors:{},token:{}},m.Z=n},7210:function(T,m,e){"use strict";var t=e(32735),c=e(14763),o=e(96192),a=e(94958),s=e(42815),r=e(60216),d=e.n(r),y=e(67879);const n=({token:h,tokenType:v})=>{const{formatMessage:x}=(0,y.Z)(),g=(0,o.lm)(),{trackUsage:i}=(0,o.rS)(),{copy:p}=(0,o.VP)(),A=C=>async()=>{await p(C)&&(i("didCopyTokenKey",{tokenType:v}),g({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(o.Y_,{endAction:h&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(c.h,{label:x({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:A(h),noBorder:!0,icon:t.createElement(a.Z,null),style:{padding:0,height:"1rem"}})),title:h||x({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:x(h?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(s.Z,null),iconBackground:"neutral100"})};n.defaultProps={token:null},n.propTypes={token:d().string,tokenType:d().string.isRequired},m.Z=n},58380:function(T,m,e){"use strict";var t=e(32735),c=e(15367),o=e(60216),a=e.n(o),s=e(67879);const r=({errors:d,values:y,onChange:n,canEditInputs:h})=>{const{formatMessage:v}=(0,s.Z)();return t.createElement(c.g,{label:v({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:d.description?v(d.description?.id?d.description:{id:d.description,defaultMessage:d.description}):null,onChange:n,disabled:!h},y.description)};r.propTypes={errors:a().shape({description:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({description:a().string}).isRequired},r.defaultProps={errors:{}},m.Z=r},37823:function(T,m,e){"use strict";var t=e(32735),c=e(2846),o=e(60216),a=e.n(o),s=e(67879);const r=({errors:d,values:y,onChange:n,canEditInputs:h})=>{const{formatMessage:v}=(0,s.Z)();return t.createElement(c.o,{name:"name",error:d.name?v(d.name?.id?d.name:{id:d.name,defaultMessage:d.name}):null,label:v({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:n,value:y.name,disabled:!h,required:!0})};r.propTypes={errors:a().shape({name:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({name:a().string}).isRequired},r.defaultProps={errors:{}},m.Z=r},32655:function(T,m,e){"use strict";var t=e(32735),c=e(16773),o=e(40260),a=e(60216),s=e.n(a),r=e(67879);const d=({name:y,errors:n,values:h,onChange:v,canEditInputs:x,options:g,label:i})=>{const{formatMessage:p}=(0,r.Z)();return t.createElement(c.P,{name:y,label:p({id:i.id,defaultMessage:i.defaultMessage}),value:h&&h[y],error:n[y]?p(n[y]?.id?n[y]:{id:n[y],defaultMessage:n[y]}):null,onChange:v,placeholder:"Select",required:!0,disabled:!x},g&&g.map(({value:A,label:C})=>t.createElement(o.W,{key:A,value:A},p(C))))};d.propTypes={name:s().string,options:s().arrayOf(s().shape({label:s().shape({id:s().string,defaultMessage:s().string}),value:s().string})),errors:s().shape({type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({type:s().string}).isRequired,label:s().shape({id:s().string,defaultMessage:s().string}).isRequired},d.defaultProps={name:"type",errors:{},options:[]},m.Z=d},49756:function(T,m,e){"use strict";e.d(m,{Z:function(){return t},f:function(){return c}});const t="api-token",c="transfer-token"},71306:function(T,m,e){"use strict";e.d(m,{Z:function(){return Ge}});var t=e(32735),c=e(95162),o=e(56932),a=e(84642),s=e(96192),r=e(92802),d=e(67879),y=e(20108),n=e(40986),h=e(53038),v=e(74512);const x=t.createContext({selectedAction:null,routes:[],selectedActions:[],data:{allActionsIds:[],permissions:[]},onChange:()=>{},onChangeSelectAll:()=>{},setSelectedAction:()=>{}}),g=({children:u,...f})=>(0,v.jsx)(x.Provider,{value:f,children:u}),i=()=>t.useContext(x);var p=e(83923),A=e(30305),C=e(49756),U=e(91595),B=e(7210),D=e(77981),I=e(8365),R=e(10710),S=e(97037),k=e(60216),l=e.n(k),$=e(82505),Y=e(58380),N=e(37823),J=e(32655);const X=({errors:u,onChange:f,canEditInputs:E,isCreating:L,values:M,apiToken:b,onDispatch:O,setHasChangedPermissions:G})=>{const{formatMessage:H}=(0,d.Z)(),z=({target:{value:V}})=>{G(!1),V==="full-access"&&O({type:"SELECT_ALL_ACTIONS"}),V==="read-only"&&O({type:"ON_CHANGE_READ_ONLY"})},w=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(D.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(I.Z,{variant:"delta",as:"h2"},H({id:"global.details",defaultMessage:"Details"})),t.createElement(R.r,{gap:5},t.createElement(S.P,{key:"name",col:6,xs:12},t.createElement(N.Z,{errors:u,values:M,canEditInputs:E,onChange:f})),t.createElement(S.P,{key:"description",col:6,xs:12},t.createElement(Y.Z,{errors:u,values:M,canEditInputs:E,onChange:f})),t.createElement(S.P,{key:"lifespan",col:6,xs:12},t.createElement($.Z,{isCreating:L,errors:u,values:M,onChange:f,token:b})),t.createElement(S.P,{key:"type",col:6,xs:12},t.createElement(J.Z,{values:M,errors:u,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:V=>{z({target:{value:V}}),f({target:{name:"type",value:V}})},options:w,canEditInputs:E})))))};X.propTypes={errors:l().shape({name:l().string,description:l().string,lifespan:l().string,type:l().string}),onChange:l().func.isRequired,canEditInputs:l().bool.isRequired,values:l().shape({name:l().string,description:l().string,lifespan:l().oneOfType([l().number,l().string]),type:l().string}).isRequired,isCreating:l().bool.isRequired,apiToken:l().shape({id:l().oneOfType([l().number,l().string]),type:l().string,lifespan:l().string,name:l().string,accessKey:l().string,permissions:l().array,description:l().string,createdAt:l().string}),onDispatch:l().func.isRequired,setHasChangedPermissions:l().func.isRequired},X.defaultProps={errors:{},apiToken:{}};var ne=X,le=e(64092),Te=e(91779),de=e(40501);const _=({apiTokenName:u})=>{const{formatMessage:f}=(0,d.Z)();return(0,s.go)(),t.createElement(c.o,{"aria-busy":"true"},t.createElement(s.SL,{name:"API Tokens"}),t.createElement(le.T,{primaryAction:t.createElement(Te.z,{disabled:!0,startIcon:t.createElement(de.Z,null),type:"button",size:"L"},f({id:"global.save",defaultMessage:"Save"})),title:u||f({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(o.D,null,t.createElement(s.dO,null)))};_.defaultProps={apiTokenName:null},_.propTypes={apiTokenName:l().string};var ce=_,se=e(37213),ae=e.n(se),oe=e(15738),Me=e.n(oe),re=e(8471),xe=u=>{switch(u){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}};const Oe=(0,re.ZP)(D.x)`
  margin: -1px;
  border-radius: ${({theme:u})=>u.spaces[1]} 0 0 ${({theme:u})=>u.spaces[1]};
`;function ue({route:u}){const{formatMessage:f}=(0,d.Z)(),{method:E,handler:L,path:M}=u,b=M?Me()(M.split("/")):[],[O="",G=""]=L?L.split("."):[],H=xe(u.method);return t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},f({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,O),t.createElement(I.Z,{variant:"delta",textColor:"primary600"},".",G)),t.createElement(a.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(Oe,{background:H.background,borderColor:H.border,padding:2},t.createElement(I.Z,{fontWeight:"bold",textColor:H.text},E)),t.createElement(D.x,{paddingLeft:2,paddingRight:2},ae()(b,z=>t.createElement(I.Z,{key:z,textColor:z.includes(":")?"neutral600":"neutral900"},"/",z)))))}ue.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ue.propTypes={route:l().shape({handler:l().string,method:l().string,path:l().string})};var Re=ue,Ie=()=>{const{value:{selectedAction:u,routes:f}}=i(),{formatMessage:E}=(0,d.Z)(),L=u?.split(".")[0];return t.createElement(S.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},u?t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:2},f[L]?.map(M=>M.config.auth?.scope?.includes(u)||M.handler===u?t.createElement(Re,{key:M.handler,route:M}):null)):t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h3"},E({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},E({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},De=e(9435),Se=e(9379),ke=e(79624),Ae=e(31014),Le=e(19594),Be=e(73400),Ue=e.n(Be);const Ce=(0,re.iv)`
  background: ${u=>u.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`;var be=(0,re.ZP)(D.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${u=>u.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${u=>u.isActive&&Ce}
  &:hover {
    ${Ce}
  }
`;const Ze=re.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:u})=>u.colors.neutral150};
`,pe=({controllers:u,label:f,orderNumber:E,disabled:L,onExpanded:M,indexExpandendCollapsedContent:b})=>{const{value:{onChangeSelectAll:O,onChange:G,selectedActions:H,setSelectedAction:z,selectedAction:w}}=i(),[V,ie]=(0,t.useState)(!1),{formatMessage:fe}=(0,d.Z)(),q=()=>{ie(Z=>!Z),M(E)};(0,t.useEffect)(()=>{b!==null&&b!==E&&V&&ie(!1)},[b,E,V]);const K=Z=>Z===w;return t.createElement(De.U,{expanded:V,onToggle:q,variant:E%2?"primary":"secondary"},t.createElement(Se.B,{title:Ue()(f)}),t.createElement(ke.v,null,u?.map(Z=>{const ee=Z.actions.every(j=>H.includes(j.actionId)),Ee=Z.actions.some(j=>H.includes(j.actionId));return t.createElement(D.x,{key:`${f}.${Z?.controller}`},t.createElement(a.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(D.x,{paddingRight:4},t.createElement(I.Z,{variant:"sigma",textColor:"neutral600"},Z?.controller)),t.createElement(Ze,null),t.createElement(D.x,{paddingLeft:4},t.createElement(Ae.X,{value:ee,indeterminate:!ee&&Ee,onValueChange:()=>{O({target:{value:[...Z.actions]}})},disabled:L},fe({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(R.r,{gap:4,padding:4},Z?.actions&&Z?.actions.map(j=>t.createElement(S.P,{col:6,key:j.actionId},t.createElement(be,{isActive:K(j.actionId),padding:2,hasRadius:!0},t.createElement(Ae.X,{value:H.includes(j.actionId),name:j.actionId,onValueChange:()=>{G({target:{value:j.actionId}})},disabled:L},j.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>z({target:{value:j.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(Le.Z,null)))))))})))};pe.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},pe.propTypes={controllers:l().array,orderNumber:l().number,label:l().string.isRequired,disabled:l().bool,onExpanded:l().func,indexExpandendCollapsedContent:l().number};var We=pe;const ge=({section:u,...f})=>{const[E,L]=(0,t.useState)(null),M=b=>L(b);return t.createElement(D.x,{padding:4,background:"neutral0"},u&&u.map((b,O)=>t.createElement(We,{key:b.apiId,label:b.label,controllers:b.controllers,orderNumber:O,indexExpandendCollapsedContent:E,onExpanded:M,name:b.apiId,...f})))};ge.defaultProps={section:null},ge.propTypes={section:l().arrayOf(l().object)};var Ke=ge;const $e=({...u})=>{const{value:{data:f}}=i(),{formatMessage:E}=(0,d.Z)();return t.createElement(R.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(S.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(I.Z,{variant:"delta",as:"h2"},E({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(I.Z,{as:"p",textColor:"neutral600"},E({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),f?.permissions&&t.createElement(Ke,{section:f?.permissions,...u})),t.createElement(Ie,null))};var Ne=(0,t.memo)($e),me=e(25652),je=(u,f=[])=>({...u,selectedAction:null,routes:[],selectedActions:[],data:(0,me.mk)(f)}),Fe=e(97889),He=e(82879),Pe=e.n(He);const ze={data:{},selectedActions:[]};var Ve=(u,f)=>(0,Fe.ZP)(u,E=>{switch(f.type){case"ON_CHANGE":{E.selectedActions.includes(f.value)?Pe()(E.selectedActions,f.value):E.selectedActions.push(f.value);break}case"SELECT_ALL_IN_PERMISSION":{f.value.every(M=>E.selectedActions.includes(M.actionId))?f.value.forEach(M=>{Pe()(E.selectedActions,M.actionId)}):f.value.forEach(M=>{E.selectedActions.push(M.actionId)});break}case"SELECT_ALL_ACTIONS":{E.selectedActions=[...E.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const L=E.data.allActionsIds.filter(M=>M.includes("find")||M.includes("findOne"));E.selectedActions=[...L];break}case"UPDATE_PERMISSIONS_LAYOUT":{E.data=(0,me.mk)(f.value);break}case"UPDATE_ROUTES":{E.routes={...f.value};break}case"UPDATE_PERMISSIONS":{E.selectedActions=[...f.value];break}case"SET_SELECTED_ACTION":{E.selectedAction=f.value;break}default:return E}});const Ye="Name already taken";var Ge=()=>{(0,s.go)();const{formatMessage:u}=(0,d.Z)(),{lockApp:f,unlockApp:E}=(0,s.o1)(),L=(0,s.lm)(),M=(0,h.k6)(),b=(0,n.v9)(A._),[O,G]=(0,t.useState)(M.location.state?.apiToken.accessKey?{...M.location.state.apiToken}:null),{trackUsage:H}=(0,s.rS)(),z=(0,t.useRef)(H),{setCurrentStep:w}=(0,s.c1)(),{allowedActions:{canCreate:V,canUpdate:ie,canRegenerate:fe}}=(0,s.ss)(b.settings["api-tokens"]),[q,K]=(0,t.useReducer)(Ve,ze,P=>je(P,{})),{params:{id:Z}}=(0,h.$B)("/settings/api-tokens/:id"),{get:ee,post:Ee,put:j}=(0,s.kY)(),F=Z==="create";(0,y.useQuery)("content-api-permissions",async()=>{const[P,Q]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async te=>{const{data:W}=await ee(te);return W.data}));K({type:"UPDATE_PERMISSIONS_LAYOUT",value:P}),K({type:"UPDATE_ROUTES",value:Q}),O&&(O?.type==="read-only"&&K({type:"ON_CHANGE_READ_ONLY"}),O?.type==="full-access"&&K({type:"SELECT_ALL_ACTIONS"}),O?.type==="custom"&&K({type:"UPDATE_PERMISSIONS",value:O?.permissions}))},{onError(){L({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{z.current(F?"didAddTokenFromList":"didEditTokenFromList",{tokenType:C.Z})},[F]);const{status:Xe}=(0,y.useQuery)(["api-token",Z],async()=>{const{data:{data:P}}=await ee(`/admin/api-tokens/${Z}`);return G({...P}),P?.type==="read-only"&&K({type:"ON_CHANGE_READ_ONLY"}),P?.type==="full-access"&&K({type:"SELECT_ALL_ACTIONS"}),P?.type==="custom"&&K({type:"UPDATE_PERMISSIONS",value:P?.permissions}),P},{enabled:!F&&!O,onError(){L({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Qe=async(P,Q)=>{z.current(F?"willCreateToken":"willEditToken",{tokenType:C.Z}),f();const te=P.lifespan&&parseInt(P.lifespan,10)&&P.lifespan!=="0"?parseInt(P.lifespan,10):null;try{const{data:{data:W}}=F?await Ee("/admin/api-tokens",{...P,lifespan:te,permissions:P.type==="custom"?q.selectedActions:null}):await j(`/admin/api-tokens/${Z}`,{name:P.name,description:P.description,type:P.type,permissions:P.type==="custom"?q.selectedActions:null});F&&(M.replace(`/settings/api-tokens/${W.id}`,{apiToken:W}),w("apiTokens.success")),E(),G({...W}),L({type:"success",message:u(F?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),z.current(F?"didCreateToken":"didEditToken",{type:O.type,tokenType:C.Z})}catch(W){const ve=(0,p.I)(W.response.data);Q.setErrors(ve),W?.response?.data?.error?.message===Ye?L({type:"warning",message:W.response.data.message||"notification.error.tokennamenotunique"}):L({type:"warning",message:W?.response?.data?.message||"notification.error"}),E()}},[Je,ye]=(0,t.useState)(!1),_e={...q,onChange:({target:{value:P}})=>{ye(!0),K({type:"ON_CHANGE",value:P})},onChangeSelectAll:({target:{value:P}})=>{ye(!0),K({type:"SELECT_ALL_IN_PERMISSION",value:P})},setSelectedAction:({target:{value:P}})=>{K({type:"SET_SELECTED_ACTION",value:P})}},he=ie&&!F||V&&F;return!F&&!O&&Xe!=="success"?t.createElement(ce,{apiTokenName:O?.name}):t.createElement(g,{value:_e},t.createElement(c.o,null,t.createElement(s.SL,{name:"API Tokens"}),t.createElement(r.J9,{validationSchema:me.fK,validateOnChange:!1,initialValues:{name:O?.name||"",description:O?.description||"",type:O?.type,lifespan:O?.lifespan?O.lifespan.toString():O?.lifespan},enableReinitialize:!0,onSubmit:(P,Q)=>Qe(P,Q)},({errors:P,handleChange:Q,isSubmitting:te,values:W,setFieldValue:ve})=>(Je&&W?.type!=="custom"&&ve("type","custom"),t.createElement(s.l0,null,t.createElement(U.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:O,setToken:G,canEditInputs:he,canRegenerate:fe,isSubmitting:te,regenerateUrl:"/admin/api-tokens/"}),t.createElement(o.D,null,t.createElement(a.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(O?.name)&&t.createElement(B.Z,{token:O?.accessKey,tokenType:C.Z}),t.createElement(ne,{errors:P,onChange:Q,canEditInputs:he,isCreating:F,values:W,apiToken:O,onDispatch:K,setHasChangedPermissions:ye}),t.createElement(Ne,{disabled:!he||W?.type==="read-only"||W?.type==="full-access"}))))))))}},25652:function(T,m,e){"use strict";e.d(m,{IX:function(){return s},fK:function(){return n},mk:function(){return v}});var t=e(14723),c=e(85544),o=e(76698),s=(x,g,i="en")=>{if(g&&typeof g=="number"){const p=g/24/60/60/1e3;return(0,t.Z)((0,c.Z)(new Date(x),p),"PPP",{locale:o[i]})}return"Unlimited"},r=e(96192),d=e(24346),n=d.Ry().shape({name:d.Z_(r.I0.string).max(100).required(r.I0.required),type:d.Z_(r.I0.string).oneOf(["read-only","full-access","custom"]).required(r.I0.required),description:d.Z_().nullable(),lifespan:d.Rx().integer().min(0).nullable().defined(r.I0.required)}),v=x=>{const g={allActionsIds:[],permissions:[]};return g.permissions=Object.keys(x).map(i=>({apiId:i,label:i.split("::")[1],controllers:Object.keys(x[i].controllers).map(p=>({controller:p,actions:x[i].controllers[p].map(A=>{const C=`${i}.${p}.${A}`;return i.includes("api::")&&g.allActionsIds.push(C),{action:A,actionId:C}}).flat()})).flat()})),g}},60528:function(T){function m(e,t,c,o){for(var a=e.length,s=c+(o?1:-1);o?s--:++s<a;)if(t(e[s],s,e))return s;return-1}T.exports=m},87650:function(T,m,e){var t=e(60528),c=e(25556),o=e(54256);function a(s,r,d){return r===r?o(s,r,d):t(s,c,d)}T.exports=a},15880:function(T){function m(e,t,c,o){for(var a=c-1,s=e.length;++a<s;)if(o(e[a],t))return a;return-1}T.exports=m},25556:function(T){function m(e){return e!==e}T.exports=m},25026:function(T,m,e){var t=e(26460),c=e(87650),o=e(15880),a=e(76535),s=e(66438),r=Array.prototype,d=r.splice;function y(n,h,v,x){var g=x?o:c,i=-1,p=h.length,A=n;for(n===h&&(h=s(h)),v&&(A=t(n,a(v)));++i<p;)for(var C=0,U=h[i],B=v?v(U):U;(C=g(A,B,C,x))>-1;)A!==n&&d.call(A,C,1),d.call(n,C,1);return n}T.exports=y},54256:function(T){function m(e,t,c){for(var o=c-1,a=e.length;++o<a;)if(e[o]===t)return o;return-1}T.exports=m},37213:function(T,m,e){var t=e(26460),c=e(88904),o=e(52920),a=e(77236);function s(r,d){var y=a(r)?t:o;return y(r,c(d,3))}T.exports=s},82879:function(T,m,e){var t=e(94569),c=e(83147),o=t(c);T.exports=o},83147:function(T,m,e){var t=e(25026);function c(o,a){return o&&o.length&&a&&a.length?t(o,a):o}T.exports=c},15738:function(T,m,e){var t=e(4293);function c(o){var a=o==null?0:o.length;return a?t(o,1,a):[]}T.exports=c},9435:function(T,m,e){"use strict";e.d(m,{U:function(){return x},y:function(){return h}});var t=e(74512),c=e(32735),o=e(8471),a=e(85612),s=e(37808),r=e(8365),d=e(84642),y=e(77981);const n=({theme:g,expanded:i,variant:p,disabled:A,error:C})=>C?`1px solid ${g.colors.danger600} !important`:A?`1px solid ${g.colors.neutral150}`:i?`1px solid ${g.colors.primary600}`:p==="primary"?`1px solid ${g.colors.neutral0}`:`1px solid ${g.colors.neutral100}`,h=(0,o.ZP)(r.Z)``,v=(0,o.ZP)(y.x)`
  border: ${n};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:g})=>g.colors.primary600};

    ${h} {
      color: ${({theme:g,expanded:i})=>i?void 0:g.colors.primary700};
    }

    ${r.Z} {
      color: ${({theme:g,expanded:i})=>i?void 0:g.colors.primary600};
    }

    & > ${d.k} {
      background: ${({theme:g})=>g.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:g})=>g.colors.primary200};
    }
  }
`,x=({children:g,disabled:i=!1,error:p,expanded:A=!1,hasErrorMessage:C=!0,id:U,onToggle:B,toggle:D,size:I="M",variant:R="primary",shadow:S})=>{const k=(0,s.M)(U),l=c.useMemo(()=>({expanded:A,onToggle:B,toggle:D,id:k,size:I,variant:R,disabled:i}),[i,A,k,B,I,D,R]);return(0,t.jsxs)(a.S.Provider,{value:l,children:[(0,t.jsx)(v,{"data-strapi-expanded":A,disabled:i,"aria-disabled":i,expanded:A,hasRadius:!0,variant:R,error:p,shadow:S,children:g}),p&&C&&(0,t.jsx)(y.x,{paddingTop:1,children:(0,t.jsx)(r.Z,{variant:"pi",textColor:"danger600",children:p})})]})}},79624:function(T,m,e){"use strict";e.d(m,{v:function(){return a}});var t=e(74512),c=e(85612),o=e(77981);const a=({children:s,...r})=>{const{expanded:d,id:y}=(0,c.A)();if(!d)return null;const n=`accordion-content-${y}`,h=`accordion-label-${y}`,v=`accordion-desc-${y}`;return(0,t.jsx)(o.x,{role:"region",id:n,"aria-labelledby":h,"aria-describedby":v,...r,children:s})}},85612:function(T,m,e){"use strict";e.d(m,{A:function(){return o},S:function(){return c}});var t=e(32735);const c=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),o=()=>(0,t.useContext)(c)},9379:function(T,m,e){"use strict";e.d(m,{B:function(){return g}});var t=e(74512),c=e(91917),o=e(8471),a=e(9435),s=e(85612);const r=({expanded:i,disabled:p,variant:A})=>{let C="neutral100";return i?C="primary100":p?C="neutral150":A==="primary"&&(C="neutral0"),C};var d=e(43743),y=e(18129),n=e(84642),h=e(8365);const v=(0,o.ZP)(d.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:i,expanded:p})=>p?i.colors.primary600:i.colors.neutral500};
    }
  }
`,x=(0,o.ZP)(n.k)`
  min-height: ${({theme:i,size:p})=>i.sizes.accordions[p]};
  border-radius: ${({theme:i,expanded:p})=>p?`${i.borderRadius} ${i.borderRadius} 0 0`:i.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:i})=>i.colors.primary600};
      }
    }
  }
`,g=({title:i,description:p,as:A="span",togglePosition:C="right",action:U,...B})=>{const{onToggle:D,toggle:I,expanded:R,id:S,size:k,variant:l,disabled:$}=(0,s.A)(),Y=`accordion-content-${S}`,N=`accordion-label-${S}`,J=`accordion-desc-${S}`,X=k==="M"?6:4,ne=k==="M"?X:X-2,le=r({expanded:R,disabled:$,variant:l}),de={as:A,fontWeight:k==="S"?"bold":void 0,id:N,textColor:R?"primary600":"neutral700",ellipsis:!0,variant:k==="M"?"delta":void 0},_=R?"primary600":"neutral600",ce=R?"primary200":"neutral200",se=k==="M"?`${32/16}rem`:`${24/16}rem`,ae=()=>{$||(I&&!D?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),I()):D&&D())},oe=(0,t.jsx)(n.k,{justifyContent:"center",borderRadius:"50%",height:se,width:se,transform:R?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:$?"not-allowed":"pointer",onClick:ae,shrink:0,children:(0,t.jsx)(y.J,{as:c.Z,width:k==="M"?`${11/16}rem`:`${8/16}rem`,color:R?"primary600":"neutral600"})});return(0,t.jsx)(x,{paddingBottom:ne,paddingLeft:X,paddingRight:X,paddingTop:ne,background:le,expanded:R,size:k,justifyContent:"space-between",cursor:$?"not-allowed":"",children:(0,t.jsxs)(n.k,{gap:3,flex:1,maxWidth:"100%",children:[C==="left"&&oe,(0,t.jsx)(v,{onClick:ae,"aria-disabled":$,"aria-expanded":R,"aria-controls":Y,"aria-labelledby":N,"data-strapi-accordion-toggle":!0,expanded:R,type:"button",flex:1,minWidth:0,...B,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.y,{...de,children:i}),p&&(0,t.jsx)(h.Z,{as:"p",id:J,textColor:_,children:p})]})}),C==="right"&&(0,t.jsxs)(n.k,{gap:3,children:[oe,U]}),C==="left"&&U]})})}}}]);
