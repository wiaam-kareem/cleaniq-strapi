"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[1049],{91595:function(B,T,e){e.d(T,{Z:function(){return D}});var t=e(32735),y=e(64092),d=e(84642),o=e(91779),n=e(96192),a=e(40501),i=e(70788),p=e(60216),s=e.n(p),m=e(67879),c=e(69321),E=e(59177);const u=(K,P,N,r)=>{const[U,C]=(0,t.useState)(!1),I=(0,n.lm)(),{post:Z}=(0,n.kY)(),{formatAPIError:k}=(0,n.So)();return{regenerateData:async()=>{try{const{data:{data:{accessKey:O}}}=await Z(`${K}${P}/regenerate`);C(!1),N(O)}catch(O){C(!1),r?r(O):O instanceof E.d7&&I({type:"warning",message:k(O)})}},isLoadingConfirmation:U}},g=({onRegenerate:K,idToRegenerate:P,backUrl:N,onError:r})=>{const{formatMessage:U}=(0,m.Z)(),[C,I]=(0,t.useState)(!1),{regenerateData:Z,isLoadingConfirmation:k}=u(N,P,K,r),W=async()=>{Z(),I(!1)};return t.createElement(t.Fragment,null,t.createElement(o.z,{startIcon:t.createElement(c.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>I(!0),name:"regenerate"},U({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(n.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(c.Z,null),isConfirmButtonLoading:k,isOpen:C,onToggleDialog:()=>I(!1),onConfirm:W,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};g.defaultProps={onRegenerate(){},onError:void 0},g.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};var l=g;const M=({title:K,token:P,setToken:N,canEditInputs:r,canRegenerate:U,isSubmitting:C,backUrl:I,regenerateUrl:Z,onErrorRegenerate:k})=>{const{formatMessage:W}=(0,m.Z)(),O=G=>{N({...P,accessKey:G})};return t.createElement(y.T,{title:P?.name||W(K),primaryAction:r?t.createElement(d.k,{gap:2},U&&P?.id&&t.createElement(l,{backUrl:Z,onRegenerate:O,idToRegenerate:P?.id,onError:k}),t.createElement(o.z,{disabled:C,loading:C,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},W({id:"global.save",defaultMessage:"Save"}))):U&&P?.id&&t.createElement(l,{onRegenerate:O,idToRegenerate:P?.id,backUrl:Z}),navigationAction:t.createElement(n.rU,{startIcon:t.createElement(i.Z,null),to:I},W({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};M.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},M.defaultProps={token:void 0,onErrorRegenerate:void 0};var D=M},82505:function(B,T,e){var t=e(32735),y=e(16773),d=e(40260),o=e(8365),n=e(60216),a=e.n(n),i=e(67879),p=e(25652);const s=({token:m,errors:c,values:E,onChange:u,isCreating:g})=>{const{formatMessage:l}=(0,i.Z)();return t.createElement(t.Fragment,null,t.createElement(y.P,{name:"lifespan",label:l({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:E.lifespan!==null?E.lifespan:"0",error:c.lifespan?l(c.lifespan?.id?c.lifespan:{id:c.lifespan,defaultMessage:c.lifespan}):null,onChange:M=>{u({target:{name:"lifespan",value:M}})},required:!0,disabled:!g,placeholder:"Select"},t.createElement(d.W,{value:"604800000"},l({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(d.W,{value:"2592000000"},l({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(d.W,{value:"7776000000"},l({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(d.W,{value:"0"},l({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!g&&`${l({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,p.IX)(m?.createdAt,parseInt(E.lifespan,10))}`))};s.propTypes={errors:a().shape({lifespan:a().string}),onChange:a().func.isRequired,values:a().shape({lifespan:a().oneOfType([a().number,a().string])}).isRequired,isCreating:a().bool.isRequired,token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().string,name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string})},s.defaultProps={errors:{},token:{}},T.Z=s},7210:function(B,T,e){var t=e(32735),y=e(14763),d=e(96192),o=e(94958),n=e(42815),a=e(60216),i=e.n(a),p=e(67879);const s=({token:m,tokenType:c})=>{const{formatMessage:E}=(0,p.Z)(),u=(0,d.lm)(),{trackUsage:g}=(0,d.rS)(),{copy:l}=(0,d.VP)(),M=D=>async()=>{await l(D)&&(g("didCopyTokenKey",{tokenType:c}),u({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(d.Y_,{endAction:m&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(y.h,{label:E({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:M(m),noBorder:!0,icon:t.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:m||E({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:E(m?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(n.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:i().string,tokenType:i().string.isRequired},T.Z=s},58380:function(B,T,e){var t=e(32735),y=e(15367),d=e(60216),o=e.n(d),n=e(67879);const a=({errors:i,values:p,onChange:s,canEditInputs:m})=>{const{formatMessage:c}=(0,n.Z)();return t.createElement(y.g,{label:c({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:i.description?c(i.description?.id?i.description:{id:i.description,defaultMessage:i.description}):null,onChange:s,disabled:!m},p.description)};a.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},a.defaultProps={errors:{}},T.Z=a},37823:function(B,T,e){var t=e(32735),y=e(2846),d=e(60216),o=e.n(d),n=e(67879);const a=({errors:i,values:p,onChange:s,canEditInputs:m})=>{const{formatMessage:c}=(0,n.Z)();return t.createElement(y.o,{name:"name",error:i.name?c(i.name?.id?i.name:{id:i.name,defaultMessage:i.name}):null,label:c({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:s,value:p.name,disabled:!m,required:!0})};a.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},a.defaultProps={errors:{}},T.Z=a},32655:function(B,T,e){var t=e(32735),y=e(16773),d=e(40260),o=e(60216),n=e.n(o),a=e(67879);const i=({name:p,errors:s,values:m,onChange:c,canEditInputs:E,options:u,label:g})=>{const{formatMessage:l}=(0,a.Z)();return t.createElement(y.P,{name:p,label:l({id:g.id,defaultMessage:g.defaultMessage}),value:m&&m[p],error:s[p]?l(s[p]?.id?s[p]:{id:s[p],defaultMessage:s[p]}):null,onChange:c,placeholder:"Select",required:!0,disabled:!E},u&&u.map(({value:M,label:D})=>t.createElement(d.W,{key:M,value:M},l(D))))};i.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},i.defaultProps={name:"type",errors:{},options:[]},T.Z=i},49756:function(B,T,e){e.d(T,{Z:function(){return t},f:function(){return y}});const t="api-token",y="transfer-token"},25652:function(B,T,e){e.d(T,{IX:function(){return n},fK:function(){return s},mk:function(){return c}});var t=e(14723),y=e(85544),d=e(76698),n=(E,u,g="en")=>{if(u&&typeof u=="number"){const l=u/24/60/60/1e3;return(0,t.Z)((0,y.Z)(new Date(E),l),"PPP",{locale:d[g]})}return"Unlimited"},a=e(96192),i=e(24346),s=i.Ry().shape({name:i.Z_(a.I0.string).max(100).required(a.I0.required),type:i.Z_(a.I0.string).oneOf(["read-only","full-access","custom"]).required(a.I0.required),description:i.Z_().nullable(),lifespan:i.Rx().integer().min(0).nullable().defined(a.I0.required)}),c=E=>{const u={allActionsIds:[],permissions:[]};return u.permissions=Object.keys(E).map(g=>({apiId:g,label:g.split("::")[1],controllers:Object.keys(E[g].controllers).map(l=>({controller:l,actions:E[g].controllers[l].map(M=>{const D=`${g}.${l}.${M}`;return g.includes("api::")&&u.allActionsIds.push(D),{action:M,actionId:D}}).flat()})).flat()})),u}},1930:function(B,T,e){e.d(T,{Z:function(){return ne}});var t=e(32735),y=e(95162),d=e(56932),o=e(84642),n=e(96192),a=e(92802),i=e(67879),p=e(20108),s=e(40986),m=e(53038),c=e(83923),E=e(30305),u=e(49756),g=e(91595),l=e(7210),M=e(77981),D=e(8365),K=e(10710),P=e(97037),N=e(60216),r=e.n(N),U=e(82505),C=e(58380),I=e(37823),Z=e(32655);const k=({errors:A,onChange:L,canEditInputs:F,isCreating:h,values:x,transferToken:v})=>{const{formatMessage:$}=(0,i.Z)(),X=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(M.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(D.Z,{variant:"delta",as:"h2"},$({id:"global.details",defaultMessage:"Details"})),t.createElement(K.r,{gap:5},t.createElement(P.P,{key:"name",col:6,xs:12},t.createElement(I.Z,{errors:A,values:x,canEditInputs:F,onChange:L})),t.createElement(P.P,{key:"description",col:6,xs:12},t.createElement(C.Z,{errors:A,values:x,canEditInputs:F,onChange:L})),t.createElement(P.P,{key:"lifespan",col:6,xs:12},t.createElement(U.Z,{isCreating:h,errors:A,values:x,onChange:L,token:v})),t.createElement(P.P,{key:"permissions",col:6,xs:12},t.createElement(Z.Z,{name:"permissions",values:x,errors:A,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:Y=>{L({target:{name:"permissions",value:Y}})},options:X,canEditInputs:F})))))};k.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},k.defaultProps={errors:{},transferToken:{}};var W=k,O=e(64092),G=e(91779),q=e(40501);const Q=({transferTokenName:A})=>{const{formatMessage:L}=(0,i.Z)();return(0,n.go)(),t.createElement(y.o,{"aria-busy":"true"},t.createElement(n.SL,{name:"Transfer Tokens"}),t.createElement(O.T,{primaryAction:t.createElement(G.z,{disabled:!0,startIcon:t.createElement(q.Z,null),type:"button",size:"L"},L({id:"global.save",defaultMessage:"Save"})),title:A||L({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(d.D,null,t.createElement(n.dO,null)))};Q.defaultProps={transferTokenName:null},Q.propTypes={transferTokenName:r().string};var w=Q,V=e(24346),ee=V.Ry().shape({name:V.Z_(n.I0.string).max(100).required(n.I0.required),description:V.Z_().nullable(),lifespan:V.Rx().integer().min(0).nullable().defined(n.I0.required),permissions:V.Z_(n.I0.string).required(n.I0.required)});const te="Name already taken";var ne=()=>{(0,n.go)();const{formatMessage:A}=(0,i.Z)(),{lockApp:L,unlockApp:F}=(0,n.o1)(),h=(0,n.lm)(),x=(0,m.k6)(),[v,$]=(0,t.useState)(x.location.state?.transferToken.accessKey?{...x.location.state.transferToken}:null),{trackUsage:X}=(0,n.rS)(),Y=(0,t.useRef)(X),{setCurrentStep:se}=(0,n.c1)(),ae=(0,s.v9)(E._),{allowedActions:{canCreate:re,canUpdate:ie,canRegenerate:oe}}=(0,n.ss)(ae.settings["transfer-tokens"]),{params:{id:H}}=(0,m.$B)("/settings/transfer-tokens/:id"),{get:le,post:de,put:ce}=(0,n.kY)(),R=H==="create",{formatAPIError:b}=(0,n.So)();(0,t.useEffect)(()=>{Y.current(R?"didAddTokenFromList":"didEditTokenFromList",{tokenType:u.f})},[R]);const{status:ge}=(0,p.useQuery)(["transfer-token",H],async()=>{const{data:{data:f}}=await le(`/admin/transfer/tokens/${H}`);return $({...f}),f},{enabled:!R&&!v,onError(f){f.response.data.error.details?.code==="INVALID_TOKEN_SALT"?h({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):h({type:"warning",message:b(f)})}}),ue=async(f,z)=>{Y.current(R?"willCreateToken":"willEditToken",{tokenType:u.f}),L();const J=f.lifespan&&parseInt(f.lifespan,10)&&f.lifespan!=="0"?parseInt(f.lifespan,10):null,j=f.permissions.split("-");try{const{data:{data:S}}=R?await de("/admin/transfer/tokens",{...f,lifespan:J,permissions:j}):await ce(`/admin/transfer/tokens/${H}`,{name:f.name,description:f.description,permissions:j});F(),R&&(x.replace(`/settings/transfer-tokens/${S.id}`,{transferToken:S}),se("transferTokens.success")),$({...S}),h({type:"success",message:A(R?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),Y.current(R?"didCreateToken":"didEditToken",{type:v?.permissions,tokenType:u.f})}catch(S){const pe=(0,c.I)(S.response.data);z.setErrors(pe),S?.response?.data?.error?.message===te?h({type:"warning",message:S.response.data.message||"notification.error.tokennamenotunique"}):S?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?h({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):h({type:"warning",message:S?.response?.data?.message||"notification.error"}),F()}},_=ie&&!R||re&&R;if(!R&&!v&&ge!=="success")return t.createElement(w,{transferTokenName:v?.name});const fe=f=>{f?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?h({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):h({type:"warning",message:b(f)})};return t.createElement(y.o,null,t.createElement(n.SL,{name:"Transfer Tokens"}),t.createElement(a.J9,{validationSchema:ee,validateOnChange:!1,initialValues:{name:v?.name||"",description:v?.description||"",lifespan:v?.lifespan?v.lifespan.toString():v?.lifespan,permissions:v?.permissions.join("-")},enableReinitialize:!0,onSubmit:(f,z)=>ue(f,z)},({errors:f,handleChange:z,isSubmitting:J,values:j})=>t.createElement(n.l0,null,t.createElement(g.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:v,setToken:$,canEditInputs:_,canRegenerate:oe,isSubmitting:J,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:fe}),t.createElement(d.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(v?.name)&&t.createElement(l.Z,{token:v?.accessKey,tokenType:u.f}),t.createElement(W,{errors:f,onChange:z,canEditInputs:_,isCreating:R,values:j,transferToken:v}))))))}}}]);
