{"version":3,"file":"admin.js","sources":["../../../src/commands/builders/admin.ts"],"sourcesContent":["import chalk from 'chalk';\n\nimport strapiAdmin from '@strapi/admin';\nimport { getConfigUrls } from '@strapi/utils';\n\nimport ee from '../../utils/ee';\nimport addSlash from '../../utils/addSlash';\nimport strapi from '../../Strapi';\nimport { getEnabledPlugins } from '../../core/loaders/plugins/get-enabled-plugins';\n\nexport interface Options {\n  buildDestDir: string;\n  forceBuild?: boolean;\n  optimization?: boolean;\n  srcDir: string;\n}\n\nexport default async ({ buildDestDir, forceBuild = true, optimization, srcDir }: Options) => {\n  const strapiInstance = strapi({\n    // Directories\n    appDir: srcDir,\n    distDir: buildDestDir,\n    // Options\n    autoReload: true,\n    serveAdminPanel: false,\n  });\n\n  const plugins = await getEnabledPlugins(strapiInstance, { client: true });\n\n  const env = strapiInstance.config.get('environment');\n  const { serverUrl, adminPath } = getConfigUrls(strapiInstance.config, true);\n\n  console.log(`Building your admin UI with ${chalk.green(env)} configuration...`);\n\n  // Always remove the .cache and build folders\n  await strapiAdmin.clean({ appDir: srcDir, buildDestDir });\n\n  ee.init(srcDir);\n\n  return strapiAdmin\n    .build({\n      appDir: srcDir,\n      buildDestDir,\n      // front end build env is always production for now\n      env: 'production',\n      forceBuild,\n      plugins,\n      optimize: optimization,\n      options: {\n        backend: serverUrl,\n        adminPath: addSlash(adminPath),\n        telemetryIsDisabled: strapiInstance.telemetry.isDisabled,\n      },\n    })\n    .then(() => {\n      console.log('Admin UI built successfully');\n    })\n    .catch((err: NodeJS.ErrnoException) => {\n      console.error(err);\n      process.exit(1);\n    });\n};\n"],"names":["strapi","getEnabledPlugins","getConfigUrls","chalk","strapiAdmin","ee"],"mappings":";;;;;;;;;;;AAiBA,MAAA,aAAe,OAAO,EAAE,cAAc,aAAa,MAAM,cAAc,aAAsB;AAC3F,QAAM,iBAAiBA,OAAO;AAAA;AAAA,IAE5B,QAAQ;AAAA,IACR,SAAS;AAAA;AAAA,IAET,YAAY;AAAA,IACZ,iBAAiB;AAAA,EAAA,CAClB;AAED,QAAM,UAAU,MAAMC,oCAAkB,gBAAgB,EAAE,QAAQ,MAAM;AAExE,QAAM,MAAM,eAAe,OAAO,IAAI,aAAa;AACnD,QAAM,EAAE,WAAW,cAAcC,YAAc,cAAA,eAAe,QAAQ,IAAI;AAE1E,UAAQ,IAAI,+BAA+BC,eAAAA,QAAM,MAAM,GAAG,CAAC,mBAAmB;AAG9E,QAAMC,qBAAAA,QAAY,MAAM,EAAE,QAAQ,QAAQ,cAAc;AAExDC,QAAG,KAAK,MAAM;AAEd,SAAOD,qBAAAA,QACJ,MAAM;AAAA,IACL,QAAQ;AAAA,IACR;AAAA;AAAA,IAEA,KAAK;AAAA,IACL;AAAA,IACA;AAAA,IACA,UAAU;AAAA,IACV,SAAS;AAAA,MACP,SAAS;AAAA,MACT,WAAW,SAAS,SAAS;AAAA,MAC7B,qBAAqB,eAAe,UAAU;AAAA,IAChD;AAAA,EAAA,CACD,EACA,KAAK,MAAM;AACV,YAAQ,IAAI,6BAA6B;AAAA,EAAA,CAC1C,EACA,MAAM,CAAC,QAA+B;AACrC,YAAQ,MAAM,GAAG;AACjB,YAAQ,KAAK,CAAC;AAAA,EAAA,CACf;AACL;;"}